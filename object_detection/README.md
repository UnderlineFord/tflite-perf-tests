# Introduction

This directory contains the details of the comparison of tflite models in object detection.

# Comparison results

### Results shown in the article:

| Experiment| 1. ssd_mobilenet_v3_small | 2. ssd_mobilenet_v3_large | 3. ssd_mobilenet_v2 (II- STATIC)  | 4. ssd_mobilenet_v1_1 |
|:-----:|:-----:|:-----:|:-----:|:-----:|
| baseline |8.2447|2.9859| 4.0262 | 5.4377|
| 32bit C++|NA|NA| 12.649 | 16.2938|
| 32bit Python|8.7626|3.918| 12.8385| 16.6009|
| 64bit C++|NA|NA| 17.153 | 22.8117|
| 64bit Python|18.475|8.1404| 17.0597| 22.2758|

* Raspberry Pi 4B [Aluminium Heatsink Case with Dual Fans](https://makerstation.lk/product/heat-sink-aluminum-casing-with-fan/) are used to minimize excessive heating of the device during inference runs.
* FPS calculated using COCO2017 validation set as explained in [step 6 here](https://github.com/accelr-net/tflite-perf-tests#2-object-detection).

### Results of other methods/ models

* The results shown here is the **best results** obtained from each model using different optimization schemes shown in [here](models#methods-used-for-model-optimizations).

**Model**|**dataset**|**dtype**|**input shape**|**how quantized**|**FPS (RPI32bit+CPP)**|**FPS (RPI32bit+Python)**|**FPS (RPI64bit+CPP)**|**FPS (RPI64bit+Python)**|**CPP- detected/ bbox correct**|**Python- detected/ bbox correct**
:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:
[ssd\_mobilenet\_v3\_small](models/ssd_mobilenet_v3_small)|coco|uint8|320|already quantized|8.9612|8.9234|16.4866|19.9146|YN|YY
[ssd\_mobilenet\_v3\_large](models/ssd_mobilenet_v3_large)|coco|uint8|320|already quantized|4.031|4.0618|7.4348|8.7249|YN|YY
[ssd\_mobilenet\_v2\_fpnlite\_640x640](models/ssd_mobilenet_v2_fpnlite_640x640)|coco|float32|640|[Convert only](https://github.com/accelr-net/tflite-perf-tests/tree/main/object_detection/models#3-convert-only-no-optimization)|-|0.7179|-|1.3288|NN|YY
[ssd\_mobilenet\_v2\_fpnlite\_320x320](models/ssd_mobilenet_v2_fpnlite_320x320)|coco|float32|640|[Convert only](https://github.com/accelr-net/tflite-perf-tests/tree/main/object_detection/models#3-convert-only-no-optimization)|-|2.2380l|-|5.1319|NN|YY
[ssd\_mobilenet\_v2](models/ssd_mobilenet_v2)|coco|uint8|300|[Static](https://github.com/accelr-net/tflite-perf-tests/tree/main/object_detection/models#2-static-integer-quantization-with-float-fallback-with-uint8-inference-input-type)|12.1224|12.3275|15.1486|14.2964|YY|YY
[ssd\_mobilenet\_v1\_fpn](models/ssd_mobilenet_v1_fpn)|coco|float32|640|[Convert only](https://github.com/accelr-net/tflite-perf-tests/tree/main/object_detection/models#3-convert-only-no-optimization)|-|0.0981|-|0.1087|NN|YY
[**ssd\_mobilenet\_v1\_1 (default\_1)**](models/ssd_mobilenet_v1_1%20(default_1))|-|uint8|300|already quantized|**15.8794**|**15.2136**|**19.4072**|**19.2025**|YY|YY
[**ssd\_mobilenet\_v1**](models/ssd_mobilenet_v1)|coco|uint8|300|already quantized|**15.9551**|**13.752**|**19.6126**|**19.0989**|YY|YY
[mobilenetv2\_danoorkans\_ayya](models/mobilenetv2_danoorkans_ayya)|-|uint8|300|already quantized|13.0855|13.0675|16.9024|14.2139|NN|NN
[mobilenet\_object\_localizer ](models/mobile_object_localizer)|-|uint8|192|already quantized|32.3917|37.3974|38.4623|35.7587|YY|YN


| MODEL                                               | 32 bit Python NUM_THREADS=1 mAP | 32 bit Python NUM_THREADS=1 FPS | NUM_THREADS = 4 |                  |               |          |          |            |                |                |                  |                |                  |               |          |          |            |                |                |                  |               |          |          |            |                |                |                  |                |                  |               |          |          |            |                |
|-----------------------------------------------------|---------------------------------|---------------------------------|-----------------|------------------|---------------|----------|----------|------------|----------------|----------------|------------------|----------------|------------------|---------------|----------|----------|------------|----------------|----------------|------------------|---------------|----------|----------|------------|----------------|----------------|------------------|----------------|------------------|---------------|----------|----------|------------|----------------|
|                                                     |                                 |                                 | 32 bit          |                  |               |          |          |            |                |                |                  |                |                  |               |          |          |            |                | 64 bit         |                  |               |          |          |            |                |                |                  |                |                  |               |          |          |            |                |
|                                                     |                                 |                                 | C++             |                  |               |          |          |            |                | PYTHON         |                  |                |                  |               |          |          |            |                | C++            |                  |               |          |          |            |                | PYTHON         |                  |                |                  |               |          |          |            |                |
|                                                     | IOU=0.50:0.95                   | ???                             | FPS (0-20 sec)  | FPS (20- 40 sec) | mAP           |          |          | detected ? | bbox correct ? | with GUI       |                  | without GUI    |                  | mAP           |          |          | detected ? | bbox correct ? | FPS (0-20 sec) | FPS (20- 40 sec) | mAP           |          |          | detected ? | bbox correct ? | with GUI       |                  | without GUI    |                  | mAP           |          |          | detected ? | bbox correct ? |
|                                                     |                                 |                                 |                 |                  | IOU=0.50:0.95 | IOU=0.50 | IOU=0.75 |            |                | FPS (0-20 sec) | FPS (20- 40 sec) | FPS (0-20 sec) | FPS (20- 40 sec) | IOU=0.50:0.95 | IOU=0.50 | IOU=0.75 |            |                |                |                  | IOU=0.50:0.95 | IOU=0.50 | IOU=0.75 |            |                | FPS (0-20 sec) | FPS (20- 40 sec) | FPS (0-20 sec) | FPS (20- 40 sec) | IOU=0.50:0.95 | IOU=0.50 | IOU=0.75 |            |                |
| 1. ssd_mobilenet_v3_small                           | 0.178                           |                                 | 8.5199          | 8.9612           | 0 (NA)        |          |          | yes        | no             | 8.7564         | 8.9234           | 9.1134         | 8.9819           | 0.178         | 0.259    | 0.188    | yes        | yes            | 16.3044        | 16.4866          | 0             |          |          | yes        | no             | 19.936         | 19.9146          | 18.7518        | 18.9176          | 0.178         | 0.259    | 0.188    | yes        | yes            |
| 2. ssd_mobilenet_v3_large                           | 0.24                            |                                 | 3.6566          | 4.031            | 0             |          |          | yes        | no             | 3.8467         | 4.0618           | 3.8941         | 3.9441           | 0.24          | 0.351    | 0.256    | yes        | yes            | 6.891          | 7.4348           | 0             |          |          | yes        | no             | 8.7938         | 8.7249           | 8.3081         | 7.869            | 0.24          | 0.351    | 0.256    | yes        | yes            |
| 3. ssd_mobilenet_v2_fpnlite_640 (I- DYNAMIC)        | x                               |                                 | -               | -                |               |          |          | -          | -              | 0.6375         | 0.6604           | 0.6485         | 0.6441           |               |          |          | yes        | yes            | -              | -                |               |          |          | -          | -              | 1.1909         | 1.1753           | 1.106          | 1.1095           |               | 0.179    | 0.155    | yes        | yes            |
| 3. ssd_mobilenet_v2_fpnlite_640 (III- CONVERT-ONLY) | x                               |                                 | -               | -                |               |          |          |            | -              | 0.7059         | 0.7179           | 0.7166         | 0.733            |               |          |          | yes        | yes            | -              | -                |               |          |          |            | -              | 1.4505         | 1.3288           | 1.3799         | 1.294            |               | 0.176    | 0.151    | yes        | yes            |
| 4. ssd_mobilenet_v2_fpnlite_320 (I- DYNAMIC)        | x                               |                                 | -               | -                |               |          |          | -          | -              | 1.9638         | 1.9446           | 1.858          | 1.8013           |               |          |          | yes        | yes            | -              | -                |               |          |          | -          | -              | 4.816          | 4.3872           | 4.454          | 4.1999           |               | 0.141    | 0.116    | yes        | yes            |
| 4. ssd_mobilenet_v2_fpnlite_320 (III- CONVERT-ONLY) | x                               |                                 | -               | -                |               |          |          | -          | -              | 2.2877         | 2.238            | 2.3487         | 2.3607           |               |          |          | yes        | yes            | -              | -                |               |          |          | -          | -              | 5.6671         | 5.1319           | 5.3027         | 4.9963           |               | 0.132    | 0.108    | yes        | yes            |
| 5. ssd_mobilenet_v2 (II- STATIC)                    | 0.14                            |                                 | 11.8931         | 12.1224          | 0.14          | 0.204    | 0.139    | yes        | yes            | 12.7692        | 12.3275          | 12.4888        | 11.5455          | 0.14          | 0.204    | 0.139    | yes        | yes            | 14.611         | 15.1486          | 0.142         | 0.206    | 0.143    | yes        | yes            | 15.7567        | 14.2964          | 14.9931        | 13.8374          | 0.142         | 0.206    | 0.143    | yes        | yes            |
| 6. ssd_mobilenet_v1_fpn (I- DYNAMIC)                | x                               |                                 | -               | -                |               |          |          | -          | -              | 0.2685         | 0.2527           | 0.2643         | 0.2565           |               |          |          | yes        | yes            | -              | -                |               |          |          | -          | -              | 0.2974         | 0.2725           | 0.2968         | 0.276            |               | 0.141    | 0.132    | yes        | yes            |
| 6. ssd_mobilenet_v1_fpn (III- CONVERT-ONLY)         | x                               |                                 | -               | -                |               |          |          | -          | -              | 0.1102         | 0.0981           | 0.1076         | 0.1013           |               |          |          | yes        | yes            | -              | -                |               |          |          | -          | -              | 0.1103         | 0.1087           | 0.1164         | 0.1111           |               | 0.149    | 0.139    | yes        | yes            |
| 7. ssd_mobilenet_v1_1                               | 0.148                           |                                 | 15.2307         | 15.8794          | 0.148         | 0.233    | 0.154    | yes        | yes            | 15.3744        | 15.2136          | 15.0103        | 14.0706          | 0.148         | 0.233    | 0.154    | yes        | yes            | 18.6529        | 19.4072          | 0.147         | 0.233    | 0.154    | yes        | yes            | 19.5255        | 19.2025          | 17.0691        | 18.8599          | 0.147         | 0.233    | 0.154    | yes        | yes            |

* FPS is calculated using sample_datasets as explained in [step 5 here](https://github.com/accelr-net/tflite-perf-tests#2-object-detection).
* FPS is calculated considering 20- 40 second interval from the starting time of model inferencing
* Num_threads of TensorFlow Lite Interpreter = 4

